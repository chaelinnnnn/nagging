<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>명절 잔소리 인터랙티브</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        #canvas {
            width: 100vw;
            height: 100vh;
            display: block;
            background: #000;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #fff;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="loading" id="loading">로딩 중...</div>
    
    <script>
        let audioElements = [];
        let currentIndex = 0;
        let words = [];
        let animationFrame;
        
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // 13개 단어 (띄어쓰기 제거)
        const baseWords = [
            '결혼은', '언제', '할거야?', '취업준비는', '잘되고있어?',
            '애는', '언제', '낳을거야?', '요즘', '월급은',
            '얼마나받아?', '반에서', '몇등이나하니?'
        ];
        
        // 컬러풀한 색상 팔레트
        const colors = [
            '#FF6B9D', '#FFD32A', '#FFFA65', '#FFA502', '#FF6348',
            '#4CD137', '#00D2D3', '#55E6C1', '#00B894', '#1abc9c',
            '#54A0FF', '#5F27CD', '#A29BFE', '#FDA7DF', '#D980FA',
            '#ff6b81', '#ffa502', '#26de81', '#20bf6b', '#0fb9b1',
            '#45aaf2', '#4b7bec', '#a55eea', '#778ca3', '#4b6584',
            '#2d3436', '#636e72', '#574b90', '#8854d0', '#3c40c6',
            '#05c46b', '#0fbcf9', '#3c6382', '#596275', '#303952',
            '#833471', '#6c5ce7', '#00b894', '#fdcb6e', '#e17055',
            '#d63031', '#e84393', '#2d3436', '#636e72', '#b2bec3'
        ];
        
        // 오디오 파일 목록
        const audioFiles = [
            '1-1. 리차드_결혼은.m4a', '1-1. 벨라_결혼은.m4a', '1-1. 세레나_결혼은.m4a', '지아이-결혼은.m4a',
            '1-2. 리차드_언제.m4a', '1-2. 벨라_언제.m4a', '1-2. 세레나_언제.m4a', '1-2. 지아이_언제.m4a',
            '1-3. 리차드_할거야?.m4a', '1-3. 벨라_할거야?.m4a', '1-3. 세레나_할거야?.m4a', '1-3. 지아이_할거야?.m4a',
            '2-1. 리차드_취업준비는.m4a', '2-1. 벨라_취업준비는.m4a', '2-1. 세레나_취업준비는.m4a', '2-1. 지아이_취업준비는.m4a',
            '2-2. 리차드_잘 되고 있어?.m4a', '2-2. 벨라_잘 되고 있어?.m4a', '2-2. 세레나_잘 되고 있어?.m4a', '2-2. 지아이_잘 되고 있어?.m4a',
            '3-1. 리차드_애는.m4a', '3-1. 벨라_애는.m4a', '3-1. 세레나_애는.m4a', '3-1. 지아이_애는.m4a',
            '3-2. 리차드_언제.m4a', '3-2. 벨라_언제.m4a', '3-2. 세레나_언제.m4a', '3-2. 지아이_언제.m4a',
            '3-3. 리차드_낳을 거야?.m4a', '3-3. 벨라_낳을 거야?.m4a', '3-3. 세레나_낳을 거야?.m4a', '3-3. 지아이_낳을 거야?.m4a',
            '4-1. 리차드_요즘.m4a', '4-1. 벨라_요즘.m4a', '4-1. 세레나_요즘.m4a', '4-1. 지아이_요즘.m4a',
            '4-2. 리차드_월급은.m4a', '4-2. 벨라_월급은.m4a', '4-2. 세레나_월급은.m4a', '4-2. 지아이_월급은.m4a',
            '4-3. 리차드_얼마나 받아?.m4a', '4-3. 벨라_얼마나 받아?.m4a', '4-3. 세레나_얼마나 받아?.m4a', '4-3. 지아이_얼마나 받아?.m4a',
            '5-1. 리차드_반에서.m4a', '5-1. 벨라_반에서.m4a', '5-1. 세레나_반에서.m4a', '5-1. 지아이_반에서.m4a',
            '5-2. 리차드_몇 등이나 하니?.m4a', '5-2. 벨라_몇 등이나 하니?.m4a', '5-2. 세레나_몇 등이나 하니?.m4a', '5-2. 지아이_몇 등이나 하니?.m4a',
            '로저-결혼은.mp3', '로저-언제.mp3', '로저-할 거야?.mp3', '로저-취업준비는.mp3', '로저-잘 되고 있니?.mp3',
            '로저-애는.mp3', '로저-요즘.mp3', '슬기-월급은.mp3', '로저-얼마나 받아?.mp3', '로저-반에서.mp3', '로저-몇 등이나 하니?.mp3',
            '슬기-결혼은.mp3', '슬기-언제.mp3', '슬기- 할 거야?.mp3', '슬기-취업준비는.mp3', '슬기-잘 되고 있어?.mp3',
            '슬기-애는.mp3', '슬기-낳을 거야?.mp3', '슬기-요즘.mp3', '슬기-얼마나 받아?.mp3', '슬기-반에서.mp3', '슬기-몇 등이나 하니?.mp3'
        ];
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (words.length > 0) {
                drawWords();
            }
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // 초기화
        async function init() {
            // 오디오 파일 로드
            for (let filename of audioFiles) {
                let word = filename;
                
                // 언더스코어로 분리
                if (word.includes('_')) {
                    word = word.split('_').pop();
                } else if (word.includes('-')) {
                    const parts = word.split('-');
                    word = parts.slice(1).join('-');
                }
                
                // 확장자 제거
                word = word.replace(/\.(m4a|mp3)$/i, '');
                
                // 앞의 숫자 제거
                word = word.replace(/^\d+\.\s*/, '');
                
                // 띄어쓰기 제거
                word = word.replace(/\s+/g, '');
                
                // 한글 정규화
                word = word.normalize('NFC');
                
                try {
                    const audio = new Audio(`audio/${filename}`);
                    await new Promise((resolve, reject) => {
                        audio.addEventListener('canplaythrough', resolve);
                        audio.addEventListener('error', reject);
                        audio.load();
                    });
                    
                    audioElements.push({
                        audio: audio,
                        word: word,
                        duration: audio.duration
                    });
                } catch (err) {
                    console.error(`Failed to load: ${filename}`, err);
                }
            }
            
            console.log(`${audioElements.length}개 오디오 로드 완료`);
            
            // 단어 레이아웃 생성
            createWordLayout();
            
            // 애니메이션 시작
            animate();
            
            // 로딩 화면 제거
            document.getElementById('loading').style.display = 'none';
            
            // 자동 재생 시작
            if (audioElements.length > 0) {
                playSequence();
            }
        }
        
        // 단어 레이아웃 생성
        function createWordLayout() {
            words = [];
            const padding = 15;
            const fontSize = 24;
            
            let x = padding;
            let y = padding;
            let rowHeight = 0;
            
            // 각 단어 최소 5번씩 보장
            let guaranteedWords = [];
            baseWords.forEach(word => {
                for (let i = 0; i < 5; i++) {
                    guaranteedWords.push(word);
                }
            });
            guaranteedWords.sort(() => Math.random() - 0.5);
            
            let wordIndex = 0;
            while (y < canvas.height + 100) {
                const word = wordIndex < guaranteedWords.length 
                    ? guaranteedWords[wordIndex]
                    : baseWords[Math.floor(Math.random() * baseWords.length)];
                    
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                ctx.font = `500 ${fontSize}px 'Noto Sans KR'`;
                const metrics = ctx.measureText(word);
                const width = metrics.width + padding * 2;
                const height = fontSize + padding * 2;
                
                if (x + width > canvas.width - padding) {
                    x = padding;
                    y += rowHeight + 8;
                    rowHeight = 0;
                }
                
                words.push({
                    text: word,
                    x: x,
                    y: y,
                    width: width,
                    height: height,
                    fontSize: fontSize,
                    color: color,
                    active: false,
                    flickerTime: Math.random() * 1000,
                    flickerSpeed: 0.5 + Math.random() * 1.0,
                    isAnimated: true,
                    slideOffset: 0,
                    slideSpeed: 0.4 + Math.random() * 0.8,
                    slideDirection: Math.random() > 0.5 ? 1 : -1,
                    slideDelay: Math.random() * 10000,
                    hasBoxDisappear: true,
                    boxDisappearTime: Math.random() * 5000,
                    boxVisible: true,
                    textColorWhenNoBox: colors[Math.floor(Math.random() * colors.length)],
                    hasCompleteDisappear: true,
                    disappearTime: Math.random() * 8000,
                    disappearDelay: Math.random() * 5000,
                    isVisible: true,
                    colorChangeCounter: 0
                });
                
                x += width + 8;
                rowHeight = Math.max(rowHeight, height);
                wordIndex++;
            }
        }
        
        // 애니메이션 루프
        function animate() {
            drawWords();
            animationFrame = requestAnimationFrame(animate);
        }
        
        // 단어 그리기
        function drawWords() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const time = Date.now();
            
            words.forEach(word => {
                // 완전히 사라지는 효과
                if (word.hasCompleteDisappear && !word.active) {
                    const adjustedTime = time + word.disappearDelay;
                    const cycle = (adjustedTime + word.disappearTime) % 5000;
                    word.isVisible = cycle > 1200;
                }
                
                if (!word.isVisible) return;
                
                // 박스 사라지는 효과
                if (word.hasBoxDisappear && !word.active) {
                    const cycle = (time + word.boxDisappearTime) % 4000;
                    word.boxVisible = cycle > 1000;
                    
                    if (!word.boxVisible && word.colorChangeCounter !== Math.floor(time / 4000)) {
                        word.textColorWhenNoBox = colors[Math.floor(Math.random() * colors.length)];
                        word.colorChangeCounter = Math.floor(time / 4000);
                    }
                }
                
                // 슬라이딩
                if (word.isAnimated && !word.active) {
                    const adjustedTime = time + word.slideDelay;
                    const slideCycle = adjustedTime % 10000;
                    if (slideCycle < 3000) {
                        word.slideOffset += word.slideSpeed * word.slideDirection;
                        if (word.slideOffset > 25 || word.slideOffset < -25) {
                            word.slideDirection *= -1;
                        }
                    } else {
                        word.slideOffset *= 0.9;
                    }
                }
                
                ctx.save();
                
                // 깜빡임
                let flickerOpacity;
                if (word.active) {
                    flickerOpacity = 1.0;
                } else {
                    const flicker = Math.sin((time + word.flickerTime) * word.flickerSpeed * 0.01);
                    flickerOpacity = 0.25 + (flicker * 0.15);
                }
                
                // 배경 박스
                if (word.boxVisible || word.active) {
                    if (word.active) {
                        ctx.shadowColor = '#ff0000';
                        ctx.shadowBlur = 35;
                        ctx.fillStyle = '#ff0000';
                    } else {
                        ctx.shadowColor = word.color;
                        ctx.shadowBlur = 8;
                        ctx.fillStyle = adjustAlpha(word.color, flickerOpacity);
                    }
                    
                    ctx.beginPath();
                    ctx.rect(word.x, word.y, word.width, word.height);
                    ctx.fill();
                }
                
                ctx.shadowBlur = 0;
                
                // 텍스트
                const fontWeight = word.active ? 700 : 500;
                
                if (word.active) {
                    ctx.fillStyle = '#ffffff';
                    ctx.shadowColor = '#ff0000';
                    ctx.shadowBlur = 15;
                } else if (!word.boxVisible) {
                    ctx.fillStyle = word.textColorWhenNoBox;
                    ctx.shadowColor = word.textColorWhenNoBox;
                    ctx.shadowBlur = 8;
                } else {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.85)';
                }
                
                ctx.font = `${fontWeight} ${word.fontSize}px 'Noto Sans KR'`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                const textX = word.x + word.width / 2 + word.slideOffset;
                const textY = word.y + word.height / 2;
                ctx.fillText(word.text, textX, textY);
                
                ctx.restore();
            });
        }
        
        function adjustAlpha(color, alpha) {
            const r = parseInt(color.slice(1, 3), 16);
            const g = parseInt(color.slice(3, 5), 16);
            const b = parseInt(color.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        // 자동 재생 시퀀스
        function playSequence() {
            if (currentIndex >= audioElements.length) {
                currentIndex = 0; // 루프
            }
            
            const current = audioElements[currentIndex];
            
            // 해당 단어들만 활성화
            words.forEach(w => {
                w.active = (w.text === current.word);
            });
            
            // 재생
            current.audio.currentTime = 0;
            current.audio.play().catch(err => {
                console.error('재생 실패:', err);
            });
            
            // 다음 곡으로
            current.audio.onended = () => {
                currentIndex++;
                playSequence();
            };
        }
        
        // 초기화 시작
        init();
    </script>
</body>
</html>
